<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>مکمل ایڈمن پینل – ZentroMall</title>
  <link rel="icon" href="logo.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Jameel Noori Nastaleeq', 'Noto Nastaliq Urdu', sans-serif; }
    .tab-btn.active { background: #10b981; color: white; }
    table { width: 100%; border-collapse: separate; border-spacing: 0 8px; }
    th, td { padding: 14px; text-align: right; }
    th { background: #1f2937; }
    tr { background: #1e293b; }
    tr:hover { background: #374151; }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen" onload="checkLogin()">

  <div class="max-w-7xl mx-auto p-6">

    <!-- ہیڈر -->
    <div class="bg-gray-800 rounded-2xl p-6 mb-8 flex justify-between items-center">
      <h1 class="text-5xl font-bold text-yellow-400">ایڈمن پینل – ZentroMall</h1>
      <div class="flex gap-4">
        <button onclick="changeAdminPass()" class="bg-orange-600 hover:bg-orange-700 px-6 py-3 rounded-lg">پاس ورڈ بدلیں</button>
        <button onclick="logout()" class="bg-red-600 hover:bg-red-700 px-8 py-3 rounded-lg">لاگ آؤٹ</button>
      </div>
    </div>

    <!-- ٹیبز -->
    <div class="flex gap-4 mb-8 flex-wrap">
      <button onclick="openTab('orders')"    class="tab-btn active px-8 py-4 rounded-lg font-bold text-xl">آرڈر ہسٹری</button>
      <button onclick="openTab('products')"  class="tab-btn px-8 py-4 rounded-lg font-bold text-xl">پروڈکٹس مینجمنٹ</button>
      <button onclick="openTab('offers')"    class="tab-btn px-8 py-4 rounded-lg font-bold text-xl">آفر/ڈسکاؤنٹ</button>
      <button onclick="openTab('notify')"    class="tab-btn px-8 py-4 rounded-lg font-bold text-xl">نوٹیفکیشن بھیجیں</button>
    </div>

    <!-- ====================== آرڈر ہسٹری ====================== -->
    <div id="orders" class="tab-content">
      <div class="bg-gray-800 rounded-2xl p-8">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-4xl font-bold text-cyan-400">تمام آرڈرز (${orders.length})</h2>
          <div class="flex gap-4">
            <input type="text" id="searchOrder" placeholder="سرچ کریں..." class="p-3 rounded bg-gray-700" onkeyup="searchOrders()">
            <button onclick="exportExcel()" class="bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-lg">Excel ایکسپورٹ</button>
          </div>
        </div>
        <div class="overflow-x-auto">
          <table>
            <thead class="bg-gray-700">
              <tr>
                <th>#</th><th>تاریخ</th><th>نام</th><th>فون</th><th>ایڈریس</th><th>پروڈکٹس</th><th>بل</th><th>سٹیٹس</th><th>ٹریکنگ</th><th>ایکشن</th>
              </tr>
            </thead>
            <tbody id="orderBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ====================== پروڈکٹس ====================== -->
    <div id="products" class="tab-content hidden">
      <div class="bg-gray-800 rounded-2xl p-8 mb-8">
        <h2 class="text-3xl font-bold text-green-400 mb-6">نیا پروڈکٹ شامل کریں</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          <input id="pname" placeholder="پروڈکٹ نام" class="p-4 rounded bg-gray-700">
          <input id="pprice" type="number" placeholder="قیمت (PKR)" class="p-4 rounded bg-gray-700">
          <input id="pdesc" placeholder="تفصیل" class="p-4 rounded bg-gray-700">
          <input type="file" id="pimg" accept="image/*" class="p-4 bg-gray-700 text-white">
        </div>
        <button onclick="addNewProduct()" class="mt-6 w-full bg-green-600 hover:bg-green-700 py-4 rounded-xl text-2xl font-bold">
          پروڈکٹ شامل کریں
        </button>
      </div>

      <h2 class="text-3xl font-bold mb-4">تمام پروڈکٹس</h2>
      <div id="productList" class="grid grid-cols-2 md:grid-cols-4 gap-6"></div>
    </div>

    <!-- ====================== آفر/ڈسکاؤنٹ ====================== -->
    <div id="offers" class="tab-content hidden">
      <div class="bg-gray-800 rounded-2xl p-8">
        <h2 class="text-3xl font-bold text-yellow-400 mb-6">آفر/ڈسکاؤنٹ کوڈ بنائیں</h2>
        <input id="code" placeholder="کوڈ (مثلاً: EID50)" class="p-4 rounded bg-gray-700 w-64 mb-4">
        <input id="discount" type="number" placeholder="ڈسکاؤنٹ %" class="p-4 rounded bg-gray-700 w-32 mb-4">
        <button onclick="createOffer()" class="bg-purple-600 hover:bg-purple-700 px-8 py-4 rounded-lg">کوڈ بنائیں</button>
        <div id="offerList" class="mt-8"></div>
      </div>
    </div>

    <!-- ====================== نوٹیفکیشن ====================== -->
    <div id="notify" class="tab-content hidden">
      <div class="bg-gray-800 rounded-2xl p-8">
        <h2 class="text-3xl font-bold text-pink-400 mb-6">تمام کسٹمرز کو نوٹیفکیشن بھیجیں</h2>
        <textarea id="notifMsg" placeholder="پیغام لکھیں..." class="w-full p-4 rounded bg-gray-700 h-40 mb-4"></textarea>
        <button onclick="sendNotification()" class="w-full bg-pink-600 hover:bg-pink-700 py-5 rounded-xl text-2xl font-bold">
          سب کو WhatsApp پر بھیجیں
        </button>
      </div>
    </div>

  </div>

  <script src="main.js"></script>
  <script>
    function checkLogin() {
      if (localStorage.getItem("zm_admin_logged") !== "true") {
        alert("لاگ ان کریں!");
        location.href = "admin.html";
      } else {
        loadOrders();
        loadProducts();
        loadOffers();
        openTab('orders');
      }
    }

    function logout() { if(confirm("لاگ آؤٹ؟")) { localStorage.removeItem("zm_admin_logged"); location.href="admin.html"; } }
    function changeAdminPass() { const p=prompt("نیا پاس ورڈ:"); if(p&&p.length>=4){localStorage.setItem("zm_admin_pass",p); alert("بدل گیا!");}}

    function openTab(tab) {
      document.querySelectorAll('.tab-content').forEach(t=>t.classList.add('hidden'));
      document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
      document.getElementById(tab).classList.remove('hidden');
      event.target.classList.add('active');
      if(tab==='orders') loadOrders();
      if(tab==='products') loadProducts();
      if(tab==='offers') loadOffers();
    }

    // ====================== آرڈرز ======================
    function loadOrders() {
      const tbody = document.getElementById("orderBody");
      tbody.innerHTML = "";
      if(orders.length===0){ tbody.innerHTML=`<tr><td colspan="10" class="text-center py-12 text-3xl text-gray-500">کوئی آرڈر نہیں</td></tr>`; return; }
      orders.slice().reverse().forEach((o,i)=>{
        const items = o.items.map(x=>`${x.name} × ${x.qty}`).join("<br>");
        tbody.innerHTML += `
          <tr>
            <td>${orders.length-i}</td>
            <td>${o.date}</td>
            <td class="text-green-400">${o.customer.name}</td>
            <td>${o.customer.phone}</td>
            <td>${o.customer.address}</td>
            <td>${items}</td>
            <td class="text-yellow-400 font-bold">${formatPrice(o.total)}</td>
            <td><span class="${o.status==='complete'?'text-green- green-400':'text-yellow-400'}">${o.status==='complete'?'مکمل':'پینڈنگ'}</span></td>
            <td class="text-blue-400">${o.tracking_id||'—'}</td>
            <td class="flex gap-2">
              <button onclick="toggleStatus(${orders.length-1-i})" class="bg-indigo-600 px-3 py-1 rounded">ٹوگل</button>
              <button onclick="setTrack(${orders.length-1-i})" class="bg-purple-600 px-3 py-1 rounded">ٹریکنگ</button>
              <button onclick="delOrder(${orders.length-1-i})" class="bg-red-600 px-3 py-1 rounded">ڈیلیٹ</button>
            </td>
          </tr>`;
      });
    }
    function toggleStatus(i){orders[i].status=orders[i].status==='complete'?'pending':'complete';saveData();loadOrders();}
    function setTrack(i){const t=prompt("ٹریکنگ ID:",orders[i].tracking_id||"");if(t!==null){orders[i].tracking_id=t;saveData();loadOrders();}}
    function delOrder(i){if(confirm("ڈیلیٹ؟")){orders.splice(i,1);saveData();loadOrders();}}
    function searchOrders(){/* وہی پرانا فنکشن */ const t=document.getElementById("searchOrder").value.toLowerCase(); document.querySelectorAll("#orderBody tr").forEach(r=>r.style.display=r.textContent.toLowerCase().includes(t)?"":"none");}
    function exportExcel(){/* وہی پرانا فنکشن جو اوپر دیا تھا */ /* چاہے تو کاپی کرو */}

    // ====================== پروڈکٹس ======================
    function loadProducts() {
      const div = document.getElementById("productList");
      div.innerHTML = "";
      products.forEach(p => {
        div.innerHTML += `
          <div class="bg-gray-700 rounded-xl p-4 text-center">
            <img src="${p.image}" class="w-full h-48 object-cover rounded mb-3">
            <h3 class="font-bold">${p.name}</h3>
            <p class="text-2xl text-green-400">${formatPrice(p.price)}</p>
            <button onclick="deleteProduct(${p.id})" class="bg-red-600 w-full mt-3 py-2 rounded">ڈیلیٹ</button>
          </div>`;
      });
    }
    function deleteProduct(id){ if(confirm("ڈیلیٹ کریں؟")){ products=products.filter(x=>x.id!==id); saveData(); loadProducts(); }}
    function addNewProduct() {
      const name = document.getElementById("pname").value.trim();
      const price = +document.getElementById("pprice").value;
      const desc = document.getElementById("pdesc").value;
      const file = document.getElementById("pimg").files[0];
      if(!name||!price||!file) return alert("تمام فیلڈز بھریں");
      handleImageUpload({target:{files:[file]}}, img => {
        const newId = products.length ? Math.max(...products.map(x=>x.id))+1 : 1;
        products.push({id:newId, name, price, image:img, desc, category:"general"});
        saveData();
        alert("پروڈکٹ شامل ہو گئی!");
        loadProducts();
        document.getElementById("pname").value=document.getElementById("pprice").value=document.getElementById("pdesc").value="";
        document.getElementById("pimg").value="";
      });
    }

    // ====================== آفر ======================
    let offers = JSON.parse(localStorage.getItem("zm_offers")||"[]");
    function loadOffers() {
      const div = document.getElementById("offerList");
      div.innerHTML = offers.map(o=>`<div class="bg-gray-700 p-4 rounded mb-2"><b>${o.code}</b> — ${o.discount}% آف <button onclick="delOffer('${o.code}')" class="text-red-500>حذف</button></div>`).join("") || "کوئی آفر نہیں";
    }
    function createOffer() {
      const code = document.getElementById("code").value.trim().toUpperCase();
      const disc = +document.getElementById("discount").value;
      if(!code || disc<1 || disc>99) return alert("درست کوڈ اور % درج کریں");
      offers.push({code, discount:disc});
      localStorage.setItem("zm_offers", JSON.stringify(offers));
      loadOffers();
      document.getElementById("code").value=document.getElementById("discount").value="";
      alert("آفر بن گئی!");
    }

    // ====================== نوٹیفکیشن ======================
    function sendNotification() {
      const msg = document.getElementById("notifMsg").value.trim();
      if(!msg) return alert("پیغام لکھیں");
      else if(confirm(`${orders.length} کسٹمرز کو بھیجنا ہے؟`)){
        orders.forEach(o=> {
          const text = encodeURIComponent(`${msg}\n\nZentroMall سے`);
          window.open(`https://wa.me/${o.customer.phone}?text=${text}`,'_blank');
        });
        alert("نوٹیفکیشن بھیج دیا گیا!");
      }
    }
  </script>
</body>
</html>
